### **個人開発アプリ要件定義書**

### **1. アプリ名**

- **呪癖 (じゅへき)**

### **2. コンセプト**

- 関わりたくないが関わってしまう人々への鬱憤を、ゴシックホラーの世界観の中で「呪い」として昇華させる匿名SNSアプリ。

### **3. デザイン・世界観**

- **テーマ:** ゴシックホラー
- **モチーフ:** 西洋の古い教会、廃墟、魔導書など
- **カラー:** 黒やセピアを基調としたダークな色合い
- **フォント:** 装飾的で雰囲気のあるフォントを採用

### **4. 機能要件**

- **登録方法:** IDとパスワードによる登録
- **プロフィール項目:** ニックネーム、年齢、性別、**呪癖**（儀式のスタイルを選択）
- **公開範囲:** プロフィール項目は全て、他のユーザーに公開される
- **投稿可能時間:** 24時間
- **投稿フロー:** 呪いの内容を入力後、藁人形に釘を打つアニメーションで投稿完了
- **タイムライン:** 他のユーザーの投稿が一覧で表示される
- **検索:** キーワードで特定の呪いを検索できる
- **リアクション:** 他のユーザーの投稿に対し、「怨念！」ボタンで共感を示すことができる
- **アニメーション進化:** 「怨念！」の数に応じて、投稿時の藁人形アニメーションが豪華に変化する
- **ランキング:** 週間で最も多くの「怨念！」を獲得したユーザーを「今週のベスト呪いスト」として発表する
- **発生時間:** 毎日 午前2時00分 ～ 3時00分
- **概要:** 全ユーザーで協力し、HPを持つ「業火の藁人形」を焼き尽くす共闘イベント
- **イベントの流れ:**
    1. **出現:** 午前2時に、HPゲージを持つ燃え盛る藁人形が出現
    2. **攻撃:** イベント中の投稿は藁人形への攻撃となり、専用アニメーションが再生される
    3. **追撃:** 他ユーザー投稿への「怨念！」で追加ダメージを与える
    4. **結末:** 午前3時にHPを0にできていれば儀式成功となり、参加者と貢献者に報酬が付与される
- **プッシュ通知:** なし
- **投稿内容の制限:** 原則として自由（利用規約の設置を推奨）

---

### **5. 技術要件**

- **設計:** クリーンアーキテクチャ
- **各層:** domain, usecase, repository, infrastructure
- **開発方針:** ドメイン駆動設計に基づき、アプリケーションのコアとなるドメインから実装を開始する
- **言語:** Go
- **RDBMS:** PostgreSQL
- **フレームワーク:** Next.js
- **言語:** TypeScript
- **UIコンポーネント & スタイリング:**
    - Tailwind CSS: デザインシステムの基盤として、世界観に合わせたカラーパレットやフォントを定義
    - shadcn/ui: 高いカスタマイズ性を誇るUIコンポーネント群。Radix UI ベースで品質とアクセシビリティを担保
- **アニメーション:**
    - Framer Motion: UIのインタラクションやページ遷移など、基本的なアニメーションを実装
    - GSAP / Lottie: 「焼滅の儀」など、複雑なシーケンスアニメーションをリッチに表現するために採用を検討
- **タイポグラフィ:**
    - next/font を利用し、Google Fonts等から世界観に合うWebフォントを導入
    - **候補:** Cinzel Decorative, Creepster (見出し), EB Garamond (本文) など
- **アイコン:**
    - React Icons: Font Awesomeなどを含む統合アイコンライブラリから、雰囲気に合うものを採用
- **フロントエンド (Next.js):** 
    - 戦略としてServer Components優先で実装すること
    - ディレクトリは機能をアップデートしやすいようにすること。初期段階は以下のディレクトリ構造をベースに必要であれば変更は可能とする

    src/
├── app/
│   ├── (main)/             # メインのタブバーが表示される画面グループ
│   │   ├── timeline/
│   │   │   ├── page.tsx          // タイムライン画面本体
│   │   │   └── components/       // タイムライン"でしか"使わないコンポーネント
│   │   │       ├── PostCard.tsx
│   │   │       └── SearchButton.tsx
│   │   ├── ritual/
│   │   │   ├── page.tsx
│   │   │   └── components/
│   │   ├── ranking/
│   │   │   ├── page.tsx
│   │   │   └── components/
│   │   └── mypage/
│   │       ├── page.tsx
│   │       └── components/
│   ├── layout.tsx              // 全画面共通のレイアウト
│   └── globals.css
│
└── components/
    ├── ui/                     // shadcn/uiで追加される汎用コンポーネント (Button, Cardなど)
    └── common/                 // アプリ全体で共有されるカスタムコンポーネント (Header, TabBarなど)
│
└── lib/                        // APIクライアント、DB接続、便利関数など

- **バックエンド (Go) & DB (PostgreSQL):** 

---


### **バックエンド詳細要件**

#### **1. 認証・認可**
- **認証方式:** JWT認証
- **アクセストークン有効期限:** 24時間
- **リフレッシュトークン:** 実装する

#### **2. 投稿（呪詛）ドメイン**
- **文字数制限:** 最小10文字、最大300文字
- **編集・削除:** 投稿した本人のみ可能（論理削除）
- **匿名投稿:**
  - 投稿者名が表示されない
  - 匿名投稿ではイベント（焼滅の儀）に参加できない
- **公開範囲:** 全体公開のみ
- **投稿種別:** 通常投稿とイベント投稿を分離
- **保存期間:** 無期限

#### **3. 怨念（いいね）ドメイン**
- **制限:** 1ユーザーが同じ投稿に1回のみ
- **取り消し:** 可能
- **自己いいね:** 不可
- **削除投稿への怨念:**
  - カウントは表示される
  - ランキングには反映されない

#### **4. 儀式（焼滅の儀）ドメイン**
- **発生時間:** 毎日 午前2時00分 ～ 3時00分
- **藁人形HP:** 300,000（固定値）
- **藁人形の意味:** ここ最近で腹立つことがあった物の見立て
- **ダメージ計算:**
  - イベント中の投稿: 1,000ダメージ（固定値）
  - 他ユーザーへの怨念: 1,000ダメージ（投稿と同値）
  - クリティカルヒット: 10%の確率で2倍ダメージ
- **報酬（ポイント）:**
  - 参加者全員: 50pt
  - 1位: 500pt
  - 2位: 300pt
  - 3位: 100pt
- **失敗時:** 特にペナルティなし
- **投稿の扱い:** イベント専用投稿として通常タイムラインとは分離

#### **5. ランキングドメイン**
- **集計タイミング:** 2時間毎のバッチ処理でリアルタイム更新
- **スコア計算:** 怨念数のみ
- **週間リセット:** 毎週月曜0時
- **履歴保存:** 期間ごとに保存（週間、月間、全期間）
- **報酬:** 実装予定（内容未定）

#### **6. 呪癖（CurseStyle）**
- **変更:** 後から変更可能
- **機能的影響:** なし（見た目と演出のみ）
- **種類:**
  - 基本5種（炎獄の儀式、氷結の呪縛、闇夜の囁き、血盟の刻印、骸骨の舞踏）
  - 特別な呪癖スタイル（ポイントで解除）

#### **7. ポイントシステム**
- **獲得方法:** 儀式成功時の報酬
- **使い道:** 特別な呪癖スタイルの解除

#### **8. プライバシー・通知設定**
- **プライバシー設定:** 将来の拡張用（現時点では機能なし）
- **通知機能:** 現時点では実装しない

#### **9. データ削除ポリシー**
- **アカウント削除:**
  - ユーザー情報は論理削除（残す）
  - 投稿も残す
  - 「削除されたユーザー」として表示
- **投稿削除:**
  - 論理削除
  - 怨念カウントは表示
  - ランキングには反映しない


### **6. 画面遷移**

1. 起動 〜 メイン画面へのフロー
[0] 起動画面（スプラッシュスクリーン）
アプリ名「呪癖」のロゴなどが荘厳に表示される。
↓
[1] 新規登録 / ログイン画面
初めてのユーザーはここから登録へ。既存ユーザーはログイン。
↓ (新規登録の場合)
[2] プロフィール設定画面
ニックネーム、年齢、性別、そして最も重要な**「呪癖」**を選択・入力する。
↓ (登録完了 / ログイン成功)
[3] タイムライン画面 (メイン画面)
全ユーザーの呪いが時系列で表示される。ここがアプリの拠点となる。
2. メイン画面 (タブバー) からの遷移
[3] タイムライン画面
→ (ユーザー名をタップ) → [8] 他ユーザープロフィール画面
→ (検索アイコンをタップ) → [9] 検索画面
[4] 儀式画面 (焼滅の儀)
午前2時〜3時の間、燃え盛る藁人形とHPゲージが表示される。
→ (「儀式に参加する」等のボタンをタップ) → [5] 投稿画面 (イベント専用モード)
[5] 投稿画面 (中央の「呪う」ボタンからモーダルまたは全画面で表示)
呪いの内容を入力し、投稿を実行する。
→ (投稿完了後) → 直前にいた画面 ([3] タイムライン または [4] 儀式画面) に戻る。
[6] 番付画面 (ランキング)
「今週のベスト呪いスト」が一覧で表示される。
→ (ランキング内のユーザーをタップ) → [8] 他ユーザープロフィール画面
[7] マイページ
自身のプロフィール情報、これまでの投稿一覧が表示される。
→ (設定アイコンをタップ) → [10] 設定画面 (ログアウト、アカウント削除など)
3. その他の画面
[8] 他ユーザープロフィール画面
選択したユーザーのニックネーム、年齢、性別、呪癖、そして過去の投稿一覧が表示される。
[9] 検索画面
キーワード入力で呪いを検索し、結果を一覧表示する。




